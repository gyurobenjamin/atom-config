Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.command = command;

/**
 * Copyright (C) 2016 Ivan Kravets. All rights reserved.
 *
 * This source file is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2
 * as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */

var _view = require('./view');

'use babel';

var ENABLED_KEY = 'platformio-ide:donate:auto-popup-enabled2';
var COUNTER_KEY = 'platformio-ide:donate:conter';
var DEFAULT_DELAY = '13';

function command(respectCounter) {
  if (respectCounter) {
    var enabled = Boolean(parseInt(localStorage.getItem(ENABLED_KEY) || '1'));
    if (!enabled) {
      return;
    }
    var counter = parseInt(localStorage.getItem(COUNTER_KEY) || DEFAULT_DELAY);
    if (counter > 1) {
      localStorage.setItem(COUNTER_KEY, (counter - 1).toString());
      return;
    }
  }

  var view = new _view.DonateView();
  var panel = atom.workspace.addModalPanel({ item: view.getElement() });

  var disablePopup = function disablePopup() {
    localStorage.setItem(ENABLED_KEY, '0');
  };

  view.alreadyDonatedHandler = disablePopup;
  view.remindLaterHandler = function () {
    localStorage.setItem(COUNTER_KEY, DEFAULT_DELAY);
    localStorage.setItem(ENABLED_KEY, '1');
  };
  view.noThanksHandler = disablePopup;
  view.onDone = function () {
    return panel.destroy();
  };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9neXVyb2JlbmphbWluLy5hdG9tL3BhY2thZ2VzL3BsYXRmb3JtaW8taWRlL2xpYi9kb25hdGUvY29tbWFuZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQW1CeUIsUUFBUTs7QUFuQmpDLFdBQVcsQ0FBQzs7QUFxQlosSUFBTSxXQUFXLEdBQUcsMkNBQTJDLENBQUM7QUFDaEUsSUFBTSxXQUFXLEdBQUcsOEJBQThCLENBQUM7QUFDbkQsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDOztBQUVwQixTQUFTLE9BQU8sQ0FBQyxjQUFjLEVBQUU7QUFDdEMsTUFBSSxjQUFjLEVBQUU7QUFDbEIsUUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDNUUsUUFBSSxDQUFDLE9BQU8sRUFBRTtBQUNaLGFBQU87S0FDUjtBQUNELFFBQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxDQUFDO0FBQzdFLFFBQUksT0FBTyxHQUFHLENBQUMsRUFBRTtBQUNmLGtCQUFZLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUEsQ0FBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO0FBQzVELGFBQU87S0FDUjtHQUNGOztBQUVELE1BQU0sSUFBSSxHQUFHLHNCQUFnQixDQUFDO0FBQzlCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBQyxDQUFDLENBQUM7O0FBRXRFLE1BQU0sWUFBWSxHQUFHLFNBQWYsWUFBWSxHQUFTO0FBQ3pCLGdCQUFZLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztHQUN4QyxDQUFDOztBQUVGLE1BQUksQ0FBQyxxQkFBcUIsR0FBRyxZQUFZLENBQUM7QUFDMUMsTUFBSSxDQUFDLGtCQUFrQixHQUFHLFlBQU07QUFDOUIsZ0JBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ2pELGdCQUFZLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztHQUN4QyxDQUFDO0FBQ0YsTUFBSSxDQUFDLGVBQWUsR0FBRyxZQUFZLENBQUM7QUFDcEMsTUFBSSxDQUFDLE1BQU0sR0FBRztXQUFNLEtBQUssQ0FBQyxPQUFPLEVBQUU7R0FBQSxDQUFDO0NBQ3JDIiwiZmlsZSI6Ii9Vc2Vycy9neXVyb2JlbmphbWluLy5hdG9tL3BhY2thZ2VzL3BsYXRmb3JtaW8taWRlL2xpYi9kb25hdGUvY29tbWFuZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuXG4vKipcbiAqIENvcHlyaWdodCAoQykgMjAxNiBJdmFuIEtyYXZldHMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgZmlsZSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3JcbiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIHZlcnNpb24gMlxuICogYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nXG4gKiB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBJbmMuLFxuICogNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQS5cbiAqL1xuXG5pbXBvcnQge0RvbmF0ZVZpZXd9IGZyb20gJy4vdmlldyc7XG5cbmNvbnN0IEVOQUJMRURfS0VZID0gJ3BsYXRmb3JtaW8taWRlOmRvbmF0ZTphdXRvLXBvcHVwLWVuYWJsZWQyJztcbmNvbnN0IENPVU5URVJfS0VZID0gJ3BsYXRmb3JtaW8taWRlOmRvbmF0ZTpjb250ZXInO1xuY29uc3QgREVGQVVMVF9ERUxBWSA9ICcxMyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21tYW5kKHJlc3BlY3RDb3VudGVyKSB7XG4gIGlmIChyZXNwZWN0Q291bnRlcikge1xuICAgIGNvbnN0IGVuYWJsZWQgPSBCb29sZWFuKHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKEVOQUJMRURfS0VZKSB8fCAnMScpKTtcbiAgICBpZiAoIWVuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY291bnRlciA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPVU5URVJfS0VZKSB8fCBERUZBVUxUX0RFTEFZKTtcbiAgICBpZiAoY291bnRlciA+IDEpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPVU5URVJfS0VZLCAoY291bnRlciAtIDEpLnRvU3RyaW5nKCkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHZpZXcgPSBuZXcgRG9uYXRlVmlldygpO1xuICBjb25zdCBwYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZE1vZGFsUGFuZWwoe2l0ZW06IHZpZXcuZ2V0RWxlbWVudCgpfSk7XG5cbiAgY29uc3QgZGlzYWJsZVBvcHVwID0gKCkgPT4ge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKEVOQUJMRURfS0VZLCAnMCcpO1xuICB9O1xuXG4gIHZpZXcuYWxyZWFkeURvbmF0ZWRIYW5kbGVyID0gZGlzYWJsZVBvcHVwO1xuICB2aWV3LnJlbWluZExhdGVySGFuZGxlciA9ICgpID0+IHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShDT1VOVEVSX0tFWSwgREVGQVVMVF9ERUxBWSk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oRU5BQkxFRF9LRVksICcxJyk7XG4gIH07XG4gIHZpZXcubm9UaGFua3NIYW5kbGVyID0gZGlzYWJsZVBvcHVwO1xuICB2aWV3Lm9uRG9uZSA9ICgpID0+IHBhbmVsLmRlc3Ryb3koKTtcbn1cbiJdfQ==
//# sourceURL=/Users/gyurobenjamin/.atom/packages/platformio-ide/lib/donate/command.js
